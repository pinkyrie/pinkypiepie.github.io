<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/ryenney/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/ryenney/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="qt源码阅读        QString uses implicit sharing (copy-on-write) to reduce memory usage and to avoid the needless  copying of data. This also helps reduce the inherent overhead of stori">
<meta property="og:type" content="article">
<meta property="og:title" content="rye is coding">
<meta property="og:url" content="http://gitee.com/ryenney/2022/06/28/qt-doc/index.html">
<meta property="og:site_name" content="rye is coding">
<meta property="og:description" content="qt源码阅读        QString uses implicit sharing (copy-on-write) to reduce memory usage and to avoid the needless  copying of data. This also helps reduce the inherent overhead of stori">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-06-28T13:34:55.956Z">
<meta property="article:modified_time" content="2022-06-24T06:21:35.716Z">
<meta property="article:author" content="rye">
<meta name="twitter:card" content="summary"><title>[ 文章无标题 ] | rye is coding</title><link ref="canonical" href="http://gitee.com/ryenney/2022/06/28/qt-doc/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" type="text/css"><link rel="stylesheet" href="/ryenney/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/ryenney/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fa fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">rye is coding</div><div class="header-banner-info__subtitle"></div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">[ 文章无标题 ]</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-06-28</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-06-24</span></span></div></header><div class="post-body">
        <h2 id="qt源码阅读"   >
          <a href="#qt源码阅读" class="heading-link"><i class="fas fa-link"></i></a><a href="#qt源码阅读" class="headerlink" title="qt源码阅读"></a>qt源码阅读</h2>
      <ul>
<li><p>QString uses <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/implicit-sharing.html" >implicit sharing</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> (copy-on-write) to reduce memory usage and to avoid the needless  copying of data. This also helps reduce the inherent overhead of storing 16-bit characters instead of 8-bit characters.</p>
</li>
<li><p>The <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#at" >at</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>() function can be faster than [operator<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#operator-5b-5d" >]</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>(), because it never causes a <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/implicit-sharing.html#deep-copy" >deep copy</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> to occur. Alternatively, use the <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#first" >first</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>(), <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#last" >last</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>(), or <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#sliced" >sliced</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>() functions to extract several characters at a time.</p>
</li>
<li><p>When data-modifying functions increase the size of the string, they may  lead to reallocation of memory for the QString object. When this  happens, QString expands by more than it immediately needs so as to have space for further expansion without reallocation until the size of the  string has greatly increased.(qstring会在第一次resize时多要一些空间这样下一次就不用reallocate了)</p>
<ul>
<li><p>何时用iterator reference index访问string？</p>
</li>
<li><p><strong>Note:</strong> Iterators over a QString, and references to individual characters within one, cannot be relied on to remain valid when any non-<code>const</code> method of the QString is called. Accessing such an iterator or reference after the call to a non-<code>const</code> method leads to undefined behavior. When stability for iterator-like  functionality is required, you should use indexes instead of iterators  as they are not tied to QString’s internal state and thus do not get  invalidated.</p>
<p><strong>Note:</strong> Due to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/implicit-sharing.html" >implicit sharing</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, the first non-<code>const</code> operator or function used on a given QString may cause it to,  internally, perform a deep copy of its data. This invalidates all  iterators over the string and references to individual characters within it. After the first non-<code>const</code> operator, operations that  modify QString may completely (in case of reallocation) or partially  invalidate iterators and references, but other methods (such as <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#begin" >begin</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>() or <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qstring.html#end" >end</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>()) will not. Accessing an iterator or reference after it has been invalidated leads to undefined behavio</p>
</li>
<li><p>前两者都是和string的内部绑定的 如果有non-const method作用在该string上 会导致前两个get invalid</p>
</li>
</ul>
</li>
<li><p>size of string溢出时会导致bad_alloc异常抛出</p>
<ul>
<li><p>When memory allocation fails, QString throws a <code>std::bad_alloc</code> exception if the application was compiled with exception support. Out  of memory conditions in Qt containers are the only case where Qt will  throw exceptions. If exceptions are disabled, then running out of memory is undefined behavior.</p>
<p>Note that the operating system may impose further limits on  applications holding a lot of allocated memory, especially large,  contiguous blocks. Such considerations, the configuration of such  behavior or any mitigation are outside the scope of the Qt API.</p>
</li>
</ul>
</li>
<li><p>什么是implicit sharing</p>
</li>
<li></li>
<li><p>QString arg</p>
</li>
<li></li>
</ul>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://gitee.com/ryenney">rye</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://gitee.com/ryenney/2022/06/28/qt-doc/">http://gitee.com/ryenney/2022/06/28/qt-doc/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-share"><div class="social-share" data-sites="qzone, qq, weibo, wechat, douban, linkedin, facebook, twitter, google">Share to: </div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/ryenney/2022/06/28/Untitled%202/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">[ 文章无标题 ]</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/ryenney/2022/06/28/Leetcode-1/"><span class="paginator-prev__text">[ 文章无标题 ]</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#qt%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="toc-number">1.</span> <span class="toc-text">
          qt源码阅读</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://github.com/pinkyrie/pic/blob/main/202204272046093.JPG?raw=true" alt="avatar"></div><p class="sidebar-ov-author__text">be happy</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/pinkyrie" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="954365771" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">58</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">9</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">5</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/ryenney/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>rye</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.4.2</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><script src="/ryenney/js/utils.js?v=2.6.2"></script><script src="/ryenney/js/stun-boot.js?v=2.6.2"></script><script src="/ryenney/js/scroll.js?v=2.6.2"></script><script src="/ryenney/js/header.js?v=2.6.2"></script><script src="/ryenney/js/sidebar.js?v=2.6.2"></script></body></html>